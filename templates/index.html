<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gerador-de-Assinatura</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Gerador de Assinatura</h1>
    <form id="signature-form">
      <label for="first-name">Primeiro Nome*</label>
      <input type="text" id="first-name" placeholder="Seu primeiro nome" required>

      <label for="last-name">Sobrenome*</label>
      <input type="text" id="last-name" placeholder="Seu sobrenome" required>

      <label for="job-title">Cargo*</label>
      <input type="text" id="job-title" value="Gerente de Loja" readonly>

      <label for="Loja">Loja*</label>
      <select id="Loja" required>
        <option value="">Selecione a loja</option>
      </select>

      <label for="email">E-mail*</label>
      <input type="email" id="email" placeholder="seu.email@Cobasi.com.br" required>

      <button type="button" id="generate-signature">Gerar Assinatura</button>
    </form>

    <h2>Pré-visualização</h2>
    <div id="signature-download-box">
      <div id="signature-preview">
        <img src="./logo.jpg" alt="Logo Cobasi" class="logo">
        <div class="signature-text">
          <p id="full-name"></p>
          <p id="job-title-preview"></p>
          <p id="store-preview"></p> <!-- Aqui será exibido o código e o nome da loja -->
          <p id="email-preview"></p>
        </div>
        <img src="./Selos_Agrupados.png" alt="Selos" class="certification">
      </div>
      <div class="privacy-notice">
        <strong>Aviso de Privacidade:</strong> A Cobasi valoriza e respeita a privacidade dos seus dados pessoais e está comprometida em protegê-los de acordo com a LGPD. Esta mensagem e seus anexos são confidenciais. Se você recebeu esta mensagem por engano, por favor, exclua-a imediatamente.
      </div>
    </div>

    <button id="download-signature">Baixar Imagem da Assinatura</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="script.js"></script>
  <script>
    // Função para buscar lojas do backend e preencher o select
    async function fetchLojas() {
      try {
        const response = await fetch('http://127.0.0.1:5000/lojas'); // Endpoint do backend
        if (!response.ok) {
          throw new Error('Erro ao buscar lojas');
        }
        const lojas = await response.json();
  
        // Preenche o select com as opções de lojas
        const lojaSelect = document.getElementById('Loja');
        lojas.forEach(loja => {
          const option = document.createElement('option');
          option.value = loja.codigo; // Define o código como valor
          option.textContent = `${loja.codigo} - ${loja.nome}`; // Exibe código e nome no texto
          lojaSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Erro ao carregar lojas:', error);
      }
    }
  
    // Chama a função ao carregar a página
    document.addEventListener('DOMContentLoaded', fetchLojas);
  </script>
</body>
</html>